---
layout: post
title:  "汇编语言与单片机——《单片机原理及应用》读书笔记"
date:   2018-2-24 00:00:00
categories: 嵌入式
tags: 汇编
excerpt: 单片机的启动代码是汇编写的，因为在未配置堆栈时，C语言代码是无法正常工作的，所以研究单片机汇编还是很有必要的。
mathjax: true
---
* content
{:toc}
---
> C语言不具备上电立即运行的条件：全局变量没有初始化、系统堆栈没有初始化等。

- 总线的概念<br/>

    - 地址总线：一个CPU有N根地址线，则可以说这个CPU的地址总线的宽度为N。这样的CPU最多可以寻找2的N次方个内存单元。<br/>
    - 数据总线:CPU与内存或其他器件之间的数据传送是通过数据总线来进行的。数据总线的宽度决定了CPU和外界的数据传送速度。8根数据总线一次可传送一个8位二进制数据（即一个字节）。16根数据总线一次可传送两个字节。<br/>
    - 控制总线：CPU对外部器件的控制是通过控制总线来进行的。在这里控制总线是个总称，控制总线是一些不同控制线的集合。有多少根控制总线，就意味着CPU提供了对外部器件的多少种控制。所以，控制总线的宽度决定了CPU对外部器件的控制能力。<br/>

### 1.单片机概述

- 单片机的定义、发展历史、单片机的特点、单片机的发展趋势、嵌入式微控制器（单片机）与嵌入式数字信号处理器、嵌入式微处理器、嵌入式片上系统的概念。



---

### 2.单片机片内硬件结构

> 单片机的硬件组成、引脚功能、CPU组成和功能、存储器的结构、并行 i/o口、时钟电路与时序、复位操作和复位电路。

- AT89S51的硬件组成:它把那些作为控制应用所必须的基本功能部件都集成在一个尺寸有限的集成电路芯片上，具有如下功能部件和特性：
    -  (1)8位微处理器器(CPU)<br/>
    -  (2)数据存储器(`128B RAM`)<br/>
    -  (3)程序存储器(`4KB Falsh ROM`)<br/>
    -  (4)4个8位可编程并行I/O口(P0,P1,P2,P3)<br/>
    -  (5)1个全双工的异步串行口<br/>
    -  (6)2个全双工的异步串行口<br/>
    -  (7)1个看门狗定时器<br/>
    -  (8)中断系统具有5个中断源、5个中断向量<br/>
    -  (9)特殊功能寄存器(SFR)26个<br/>
    -  (10)低功耗节电模式有空闲模式和掉电模式，且具有掉电模式下的中断恢复模式。<br/>
    -  (11)3个程序加密锁定位<br/>

- 引脚按其功能可分为3类<br/>
    -  (1)电源及时钟引脚<br/>
    -  (2)控制引脚<br/>
    -  (3)I/O引脚<br/>

- AT89S51的CPU是由运算器和控制器构成的<br/>
    -  运算器：主要用来对操作数进行算术、逻辑和位操作运算。主要包括算术逻辑运算单元ALU、累加器A、程序状态寄存器PSW、位处理器及两个暂存区等。<br/>
    -  控制器：主要包括程序计算器、指令寄存器、指令译码器、定时及控制逻辑电路等。其功能是控制指令的读入、译码和执行，从而对单片机的各功能部件进行定时和逻辑控制。<br/>
        - 程序计时器PC是控制器中最基本的寄存器，它是一个独立的16位计数器，是不可访问的，即用户不能直接只用指令对PC进行读/写。<br/>
        - PC的基本工作过程是：CPU读指令，PC的内容作为所取指令的地址发送给程序寄存器，然后程序存储器按此地址输出指令字节，同时PC自动加1，这也是为什么PC被称为程序计数器的原因。<br/>
        - PC中内容变化轨迹决定了程序的流程。<br/>
        - 程序计数器的计数宽度决定了程序存储器的地址范围。AT89S51中的PC位数为16位，故可对64KB(` = 2^16 B`)的程序存储器进行寻址。<br/>

- 存储器结构：AT89S51单片机存储器结构的特点之一是将程序存储器和数据存储器分开（称为哈佛结构），并有各自的对这两个不同的存储器空间的访问指令。<br/>
    - 程序存储器是只读存储器（ROM），用于存放程序和表格之类的固定常数。AT89S51单片机的片内程序存储器为4KB的Flash，地址范围为0000H~0FFFH。AT89S51有16位地址线，可外扩的程序存储器空间最大为64KB，地址范围为0000H~FFFFH。整个程序存储器空间可以分为片内和片外两部分，CPU究竟是访问片内还是片外的程序存储器，可由EA引脚上所接的电平来确定。<br/>

    - 堆栈指针SP：堆栈指针SP的内容指示出堆栈顶部在内部RAM中的位置。AT89S51的堆栈结构属于向上生长型的堆栈（每向堆栈压入1个字节数据时，SP的内容自动加1）。堆栈的具体功能有两个：保护断点和现场保护。<br/>

- 时钟与时序：
    - 时钟周期是单片机控制信号的基本时间单位。若时钟晶体的振荡频率为f,则时钟周期T=1/f。<br/>
    - CPU完成一个基本操作所需要的时间称为机器周期。AT89S51的一个机器周期包括12个时钟周期。<br/>
    - 指令周期是执行一条指令所需的时间。<br/>

- 复位<br/>
    - 复位时单片机的初始化操作，只需给AT89S51的复位引脚RST加上大于2个机器周期的高电平就可使单片机复位。<br/>
    - 当AT89S51进行复位时，PC初始化为0000H，使AT89S51单片机从程序存储器的0000H单元开始执行程序。<br/>

---

### 3.单片机的指令系统

> 指令系统概述、指令格式、寻址方式、指令。

- 指令是CPU按照人们的意图来完成某种操作的命令，它以英文名称或缩写作为助记符。用助记符、符号地址标号等书写程序的语言成为汇编语言。<br/>
- 一条指令通常由两部分组成：操作码和操作数。操作码用来规定进行什么操作，而操作数则是指令操作的对象。操作数可能是一个具体的数据，也可能是指出到哪里取得数据的地址或符号。<br/>
- 指令的寻址方式：
    - 1、寄存器寻址方式<br/>
        - 寄存器寻址方式，就是指令中的操作数为某一寄存器的内容。<br/>
        - `MOV  A,Rn;`是把Rn中的源操作数送入到累加器A中。由于在指令中指定了从寄存器Rn中取得源操作数，所以称之为寄存器寻址方式。<br/>
    - 2、直接寻址方式<br/>
        - 在这种寻址方式中，指令直接给出操作数的单元地址，改单元地址的内容就是操作数，直接的操作数单元地址用“direct”表示。<br/>
        - `MOV  A,40H;`表示把内部RAM40H单元的内容传送到A。指令中元操作数采用的是直接寻址方式。<br/>
        - 指令中的两个操作数都可由直接寻址方式给出。<br/>
        - `MOV  42H,62H;`表示把片内RAM中62单元的内容送到片内RAM中的42H单元中。<br/>
    - 3、寄存器间接寻址方式<br/>
        - 寄存器寻址方式在寄存器中存放的是操作数，而寄存器间接寻址方式在寄存器中存放的是操作数的地址，即现从寄存器中找到操作数的地址，再按该地址找到操作数。由于操作数是通过寄存器间接得到的，因此成为寄存器间接寻址。<br/>
        - 为了区别寄存器寻址和寄存器间接寻址，在寄存器间接寻址方式中，应在寄存器名称前面加前缀标志“@”。<br/>
        - `MOV  A,@Ri;`其中Ri的内容为40H，即从Ri中找到源操作数所在的单元地址40H，然后把内部RAM40H地址单元中的内容传送给A。<br/>
    - 4、立即数寻址方式<br/>
        - 立即数寻址方式就是在指令中给出操作数。出现在指令中的操作数也称立即数。为了与直接寻址指令中的直接地址加以区别，需要在操作数前面加前缀标志`#`.
        - `MOV  A,#40H;`表示把立即数40H送给A，40H这个常数是指令代码的一部分。<br/>
    - 5、基址寄存器加变址寄存器间接寻址<br/>
        - 这种寻址方式时以DPTR或PC作为基址寄存器，以累加器A作为变址寄存器，并以两者内容相加形成的16位地址作为目的地址进行寻址的方式。<br/>
        - `MOVC A,@A+DPTR;`其中，A原有的内容为05H,DPTR的内容为0400H。该指令执行的结果是把程序存储器0405H单元的内容传送给A。<br/>
    - 6、相对寻址方式<br/>
        - 相对寻址是以该转移指令的地址（PC值）加上它的字节数，再加上相对偏移量（rel）,形成新的转移目的地址，从而程序转移到该目的地址。<br/>
        - 目的地址 = 转移指令所在的地址 + 转移指令字节数 + rel;其中，偏移量rel是单字节的带符号的8位二进制补码数。它所能表示的数的范围是-128到+127.因此，程序的转移范围是以转移指令的下条指令首地址为基准地址，相对偏移在-128到+127单元之间。<br/>
        - `SJMP rel;`在执行时，程序要转移到该指令的PC值加2在加上rel的目的地址处。<br/>

    - 7、位寻址方式<br/>
        - 位寻址是针对内部RAM和特殊功能寄存器具有位寻址功能的某位内容进行置1和清0操作。
        - `MOV  C,bit;`<br/>
        - `MOV  C,40H;`该指令的功能就是把位地址为40H的值送到进位C.<br/>
        - 8051单片机内部有1个可位寻址区，地址为20H~2FH，共16个单元。其中每个单元中的每一位都可单独作为操作数，共128位。另外，如果SFR（特殊功能寄存器片—内高128单元）的地址值能被8整除，则该SFR也可以进行位寻址。可位寻址的SFR有ACC，B，PSW，P0，P1，P2，P3，IP，IE，TCON，SCON。<br/>


---

### 4.汇编语言程序设计

> 汇编语言程序设计概述、汇编语言源程序的汇编、语言程序设计举例。

---

### 5.单片机的中断系统

> 中断技术概述、中断系统结构、中断允许与优先级的控制、响应中断请求的条件、外部中断的响应时间 、外部中断的触发方式选择、中断请求的撤销、中断服务子程序的设计和多外部中断源系统设计 。

---

### 6.定时器/计数器

> 定时器 /计数器的结构、定时器 /计数器的4种工作方式、对外部输入的计数信号要求、定时器 /计数器的编程和应用。

---

### 7.串行口

> 串行口的结构、串行口的4种工作方式、多机通信、波特率的制定方法、串行口的应用。

---

### 8.外部存储器的扩展

> 系统扩展结构、地址空间分配和外部锁存器、程序存储器的扩展、静态数据存储器的拓展、存储器的综合扩展 。

- 82C55:控制字相当于对82C55引脚I/O复用初始化，在利用A0,A1,RD,WD.来选中ABC端口来读写数据。<br/>

---

### 9.I/O扩展

- 单片机的i/o扩展概述、I/O接口芯片82C55和81C55的工作方式以及程序设计。


---

### 10.输入/输出接口设计

> LED数码管的显示原理、键盘的工作原理、LCD工作原理，以及它们的程序设计。


---
