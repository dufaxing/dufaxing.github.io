{% if page.comments != false %}
<div class="giscus-container">
  <div id="giscus"></div>
  <div id="giscus-fallback" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0;">
    <p>ğŸ’¬ è¯„è®ºåŠ è½½ä¸­...å¦‚æœé•¿æ—¶é—´æœªæ˜¾ç¤ºï¼Œè¯·<a href="https://github.com/{{ site.giscus.repo }}/discussions" target="_blank" rel="noopener">è®¿é—®GitHub Discussions</a>å‚ä¸è®¨è®ºã€‚</p>
    <p><small>éœ€è¦æ‹¥æœ‰GitHubè´¦å·å¹¶<a href="https://github.com/apps/giscus" target="_blank" rel="noopener">æˆæƒGiscusåº”ç”¨</a></small></p>
  </div>
</div>

<script src="https://giscus.app/client.js"
        data-repo="{{ site.giscus.repo }}"
        data-repo-id="{{ site.giscus.repo-id }}"
        data-category="{{ site.giscus.category }}"
        data-category-id="{{ site.giscus.category-id }}"
        data-mapping="{{ site.giscus.mapping }}"
        data-strict="{{ site.giscus.strict }}"
        data-reactions-enabled="{{ site.giscus.reactions-enabled }}"
        data-emit-metadata="{{ site.giscus.emit-metadata }}"
        data-input-position="{{ site.giscus.input-position }}"
        data-theme="{{ site.giscus.theme }}"
        data-lang="{{ site.giscus.lang }}"
        data-loading="{{ site.giscus.loading }}"
        crossorigin="anonymous"
        async>
</script>

<script>
// Giscusé”™è¯¯å¤„ç†
document.addEventListener('DOMContentLoaded', function() {
  const fallback = document.getElementById('giscus-fallback');
  const giscusContainer = document.querySelector('.giscus-container');
  
  // æ˜¾ç¤ºå›é€€ä¿¡æ¯
  fallback.style.display = 'block';
  
  // ç›‘å¬GiscusåŠ è½½äº‹ä»¶
  window.addEventListener('message', function(event) {
    if (event.origin === 'https://giscus.app') {
      if (event.data && event.data.giscus) {
        // Giscuså·²åŠ è½½ï¼Œéšè—å›é€€ä¿¡æ¯
        setTimeout(function() {
          fallback.style.display = 'none';
        }, 1000);
      }
    }
  });
  
  // è¶…æ—¶æ£€æŸ¥ï¼ˆ8ç§’ï¼‰
  setTimeout(function() {
    const giscusFrame = document.querySelector('iframe.giscus-frame');
    if (!giscusFrame || giscusFrame.style.visibility === 'hidden') {
      fallback.innerHTML = `
        <div style="text-align: center;">
          <p style="font-weight: bold; margin-bottom: 15px;">ğŸš« è¯„è®ºåŠ è½½å¤±è´¥</p>
          <div style="text-align: left; display: inline-block; margin-bottom: 15px;">
            <p>è¯·ç¡®ä¿ï¼š</p>
            <ul style="margin-left: 20px;">
              <li>å·²ç™»å½•GitHubè´¦å·</li>
              <li>å·²<a href="https://github.com/apps/giscus" target="_blank" rel="noopener">æˆæƒGiscusåº”ç”¨</a></li>
              <li>GitHub DiscussionsåŠŸèƒ½å·²å¯ç”¨</li>
            </ul>
          </div>
          <button onclick="window.location.reload()" style="background: #4a6fc7; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px;">åˆ·æ–°é¡µé¢</button>
          <a href="https://github.com/{{ site.giscus.repo }}/discussions" target="_blank" rel="noopener" style="background: #2ea44f; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; text-decoration: none; margin: 5px; display: inline-block;">å‰å¾€GitHubè®¨è®º</a>
        </div>
      `;
    }
  }, 8000);
});

// é‡æ–°åŠ è½½Giscus
function reloadGiscus() {
  const giscusFrame = document.querySelector('iframe.giscus-frame');
  if (giscusFrame) {
    giscusFrame.contentWindow.postMessage({ giscus: { setConfig: {} } }, 'https://giscus.app');
  }
}
</script>

<noscript>
  <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;">
    <p>âš ï¸ è¯·å¯ç”¨JavaScriptä»¥æŸ¥çœ‹å’Œå‘è¡¨è¯„è®º</p>
    <p>æˆ–è€…<a href="https://github.com/{{ site.giscus.repo }}/discussions" target="_blank" rel="noopener">è®¿é—®GitHub Discussions</a></p>
  </div>
</noscript>
{% endif %}